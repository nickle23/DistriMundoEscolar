<!DOCTYPE html>
<html>
<head>
    <title>Reporte de Asistencias</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 20px; 
            color: #333;
            font-size: 14px;
            line-height: 1.4;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            border: 2px solid #333;
            padding: 25px;
            position: relative;
            background: white;
        }
        .header { 
            text-align: center; 
            border-bottom: 2px solid #333; 
            padding-bottom: 20px;
            margin-bottom: 25px;
        }
        .header h1 { 
            margin: 0; 
            font-size: 24px; 
            color: #2c3e50;
            text-transform: uppercase;
        }
        .header h2 {
            margin: 5px 0;
            font-size: 16px;
            color: #7f8c8d;
        }
        .info-trabajador {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        .info-item {
            margin-bottom: 8px;
        }
        .info-label {
            font-weight: bold;
            color: #2c3e50;
        }
        .resumen-mensual {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #2ecc71;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #bdc3c7;
            text-align: center;
        }
        .stat-number {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin: 5px 0;
        }
        .pago-extras {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            border-left: 4px solid #ffc107;
            text-align: center;
        }
        .total-pago {
            font-size: 20px;
            font-weight: bold;
            color: #e67e22;
        }
        .tabla-asistencias {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 12px;
        }
        .tabla-asistencias th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: left;
            border: 1px solid #2c3e50;
            font-weight: bold;
        }
        .tabla-asistencias td {
            padding: 10px 8px;
            border: 1px solid #bdc3c7;
        }
        .estado-normal { color: #27ae60; font-weight: bold; }
        .estado-tarde { color: #f39c12; font-weight: bold; }
        .estado-falta { color: #e74c3c; font-weight: bold; }
        .firmas {
            margin-top: 50px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .firma-area {
            text-align: center;
            border-top: 2px solid #333;
            padding-top: 60px;
        }
        .observaciones {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px dashed #bdc3c7;
        }
        .no-print {
            display: none;
        }
        .periodo {
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
            color: #2c3e50;
        }
        @media print {
            body { 
                margin: 0; 
                padding: 15px;
                background: white !important;
            }
            .no-print { 
                display: none !important; 
            }
            .container { 
                border: none !important; 
                padding: 0 !important;
                margin: 0 !important;
                max-width: 100% !important;
                box-shadow: none !important;
            }
            .tabla-asistencias {
                page-break-inside: auto;
            }
            .tabla-asistencias tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã REPORTE DE ASISTENCIAS MENSUAL</h1>
            <h2>Distrimundo Escolar</h2>
            <div class="periodo" id="periodo-reporte">
                {% set meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'] %}
                <strong>Per√≠odo:</strong> {{ meses[mes|int - 1] }} {{ anio }}
            </div>
        </div>

        <!-- Informaci√≥n del Trabajador -->
        <div class="info-trabajador">
            <h3 style="margin-top: 0; color: #2c3e50;">üë§ INFORMACI√ìN DEL TRABAJADOR</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Nombre:</span> {{ trabajador.nombre }}
                </div>
                <div class="info-item">
                    <span class="info-label">DNI:</span> {{ trabajador.dni }}
                </div>
                <div class="info-item">
                    <span class="info-label">Cargo:</span> {{ trabajador.cargo }}
                </div>
                <div class="info-item">
                    <span class="info-label">√Årea:</span> {{ trabajador.area or 'N/A' }}
                </div>
                <div class="info-item">
                    <span class="info-label">Sueldo Base:</span> S/ {{ "%.2f"|format(trabajador.sueldo_base) }}
                </div>
                <div class="info-item">
                    <span class="info-label">Fecha Ingreso:</span> {{ trabajador.fecha_ingreso or 'N/A' }}
                </div>
            </div>
        </div>

        <!-- Resumen Mensual -->
        <div class="resumen-mensual">
            <h3 style="margin-top: 0; color: #2c3e50;">üìà RESUMEN MENSUAL</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div>‚úÖ D√≠as Trabajados</div>
                    <div class="stat-number">{{ estadisticas.dias_trabajados }}</div>
                </div>
                <div class="stat-card">
                    <div>‚ùå Faltas</div>
                    <div class="stat-number">{{ estadisticas.faltas }}</div>
                </div>
                <div class="stat-card">
                    <div>‚ö†Ô∏è Tardanzas</div>
                    <div class="stat-number">{{ estadisticas.tardanzas }}</div>
                </div>
                <div class="stat-card">
                    <div>‚è±Ô∏è Horas Extras</div>
                    <div class="stat-number">{{ "%.2f"|format(estadisticas.total_horas_extras) }}</div>
                </div>
            </div>
        </div>

        <!-- Pago Horas Extras -->
        <div class="pago-extras">
            <h3 style="margin-top: 0; color: #856404;">üí∞ PAGO DE HORAS EXTRAS</h3>
            <p style="font-size: 16px; margin: 8px 0;">
                <strong>Pago por Hora Extra:</strong> S/ {{ "%.2f"|format(pago.pago_por_hora) }}
            </p>
            <p style="font-size: 18px; margin: 8px 0;" class="total-pago">
                <strong>TOTAL A PAGAR:</strong> S/ {{ "%.2f"|format(pago.total_pagar) }}
            </p>
        </div>

        <!-- Detalle de Asistencias -->
        <h3 style="color: #2c3e50; border-bottom: 1px solid #bdc3c7; padding-bottom: 10px;">üìÖ DETALLE DE ASISTENCIAS</h3>
        <table class="tabla-asistencias">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Entrada</th>
                    <th>Salida</th>
                    <th>Horas Trab.</th>
                    <th>Horas Extras</th>
                    <th>Estado</th>
                    <th>Observaciones</th>
                </tr>
            </thead>
            <tbody>
                {% for dia in detalle %}
                <tr>
                    <td>{{ dia.fecha }}</td>
                    <td>{{ dia.entrada or '--:--:--' }}</td>
                    <td>{{ dia.salida or '--:--:--' }}</td>
                    <td>{{ "%.2f"|format(dia.horas_trabajadas or 0) }}</td>
                    <td>{{ "%.2f"|format(dia.horas_extras or 0) }}</td>
                    <td class="
                        {% if dia.estado == 'NORMAL' %}estado-normal
                        {% elif dia.estado == 'TARDE' %}estado-tarde
                        {% elif dia.estado == 'FALTA' %}estado-falta
                        {% else %}estado-normal{% endif %}
                    ">
                        {% if dia.estado == 'NORMAL' %}‚úÖ NORMAL
                        {% elif dia.estado == 'TARDE' %}‚ö†Ô∏è TARDE
                        {% elif dia.estado == 'FALTA' %}‚ùå FALTA
                        {% else %}{{ dia.estado }}{% endif %}
                    </td>
                    <td>{{ dia.observaciones or '' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Firmas -->
        <div class="firmas">
            <div class="firma-area">
                <strong>_________________________</strong><br>
                <span style="font-weight: bold;">FIRMA DEL TRABAJADOR</span><br>
                <span style="font-size: 12px; color: #7f8c8d;">Nombre: {{ trabajador.nombre }}</span>
            </div>
            <div class="firma-area">
                <strong>_________________________</strong><br>
                <span style="font-weight: bold;">FIRMA DEL ADMINISTRADOR</span><br>
                <span style="font-size: 12px; color: #7f8c8d;">Fecha: {{ now.strftime('%d/%m/%Y') if now else '' }}</span>
            </div>
        </div>

        <!-- Observaciones Generales -->
        <div class="observaciones">
            <strong>Observaciones Generales:</strong><br>
            <ul>
                <li>Horario establecido: 08:00 AM - 07:00 PM</li>
                <li>Tolerancia para entrada: 15 minutos (hasta 08:15 AM)</li>
                <li>Horas extras calculadas sobre las 11 horas de jornada normal</li>
                <li>Este documento es el comprobante oficial de asistencias</li>
            </ul>
        </div>
    </div>

    <!-- Botones solo para vista previa (no se imprimen) -->
    <div class="no-print" style="text-align: center; margin: 20px;">
        <button onclick="window.print()" style="padding: 12px 25px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
            üñ®Ô∏è Imprimir Reporte
        </button>
        <button onclick="window.close()" style="padding: 12px 25px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-left: 10px;">
            ‚ùå Cerrar Ventana
        </button>
    </div>

    <script>
        // Agregar fecha actual autom√°ticamente
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const fechaElementos = document.querySelectorAll('#fecha-emision, .firma-area span:last-child');
            fechaElementos.forEach(element => {
                if (element.textContent.includes('Fecha:')) {
                    element.textContent = 'Fecha: ' + now.toLocaleDateString('es-PE');
                }
            });
            
            console.log('‚úÖ Reporte de impresi√≥n cargado correctamente');
            console.log('üë§ Trabajador:', '{{ trabajador.nombre }}');
            console.log('üìÖ Per√≠odo:', '{{ meses[mes|int - 1] if meses and mes else "" }} {{ anio }}');
        });
    </script>

    <script>
// Forzar di√°logo de impresi√≥n mejorado
function imprimirReporte() {
    // Esperar a que la p√°gina cargue completamente
    setTimeout(() => {
        window.print();
    }, 500);
}

// Reemplazar el bot√≥n actual
document.addEventListener('DOMContentLoaded', function() {
    const botonImprimir = document.querySelector('button[onclick="window.print()"]');
    if (botonImprimir) {
        botonImprimir.onclick = imprimirReporte;
        botonImprimir.innerHTML = 'üíæ Guardar como PDF / Imprimir';
    }
    
    // Tambi√©n agregar atajo de teclado
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'p') {
            e.preventDefault();
            imprimirReporte();
        }
    });
});

// Mejorar compatibilidad de impresi√≥n
const style = document.createElement('style');
style.textContent = `
    @media print {
        @page {
            size: A4;
            margin: 1cm;
        }
        body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
    }
`;
document.head.appendChild(style);
</script>

</body>
</html>